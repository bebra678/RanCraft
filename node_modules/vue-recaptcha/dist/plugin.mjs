import { ref } from "vue-demi";
import { normalizeOptions, RecaptchaContextKey } from "./composables/context.mjs";
import { createRecaptchaProxy } from "./composables/proxy.mjs";
import { checkRecaptchaLoad, recaptchaLoaded } from "./script-manager/common.mjs";
export function createPlugin(scriptManagerFactory) {
  return {
    install(app, options) {
      const isReady = ref(false);
      async function waitLoaded() {
        await recaptchaLoaded.promise;
        isReady.value = true;
      }
      waitLoaded();
      checkRecaptchaLoad();
      const opt = normalizeOptions(options);
      app.provide(RecaptchaContextKey, {
        isReady,
        scriptInjected: false,
        proxy: createRecaptchaProxy(isReady),
        useScriptProvider: scriptManagerFactory(opt.params),
        options: opt
      });
    }
  };
}
